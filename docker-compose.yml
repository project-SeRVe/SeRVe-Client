version: '3.8'

services:
  edge-server:
    build:
      context: ..                      # 상위 디렉토리(SeRVe-Project) 기준
      dockerfile: SeRVe-Client/Dockerfile  # 정확한 Dockerfile 경로 지정
    container_name: serve-edge-server
    ports:
      - "9000:9000"   # Robot data ingress (Nginx)
      - "8501:8501"   # Streamlit dashboard
    environment:
      - CLOUD_URL=${CLOUD_URL:-http://172.18.0.1:8080}
      - OLLAMA_BASE_URL=http://172.18.0.1:11434
      - EDGE_EMAIL=${EDGE_EMAIL:-edge@serve.local}
      - EDGE_PASSWORD=${EDGE_PASSWORD:-edge123}
      - TEAM_ID=${TEAM_ID}
      - VECTORSTORE_PATH=/app/local_vectorstore
    volumes:
      - ./logs/edge-server:/var/log/edge-server
      - ./logs/suricata:/var/log/suricata
      - ./logs/supervisor:/var/log/supervisor
      - ./logs/nginx:/var/log/nginx
    networks:
      - serve-network
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - NET_RAW

networks:
  serve-network:
    driver: bridge
